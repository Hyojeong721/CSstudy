# TDD

### TDD란 무엇인가?

**Test-Driven Development** : 테스트 코드 주도 개발 방식.

매우 짧은 개발 사이클의 반복에 의존하는 소프트웨어 개발 프로세스.

요구되는 새로운 기능에 대한 자동화된 테스트케이스를 작성하고 해당 테스트를 통과하는 가장 간단한 코드를 작성한다. 그 후 상황에 맞게 리팩토링하는 과정을 거친다. 

#### TDD의 목표는 잘 작동하는 깔끔한 코드!

##### Add a Test

새로운 기능을 추가하기 전 **테스트를 먼저 작성**한다. 이를 위해 해당 기능의 요구사항과 명세를 분명히 이해하고 있어야 한다. 이는 사용자 케이스와 사용자 스토리 등으로 이해할 수 있으며, 이는 개발자가 코드를 작성하기 전에 보다 요구사항에 집중할 수 있도록 도와준다. 이는 정말 중요한 부분이자 테스트 주도 개발이 주는 이점이라고 볼 수 있다.

##### Run all tests and see if new one fails

어떤 새로운 기능을 추가하면 잘 작동하던 기능이 제대로 작동하지 않는 경우가 발생할 수 있다. 더 위험한 경우는 개발자가 이를 미처 인지하지 못하는 경우이다. 이러한 경우를 방지하기 위해 테스트 코드를 작성하는 것이다. 새로운 기능을 추가할 때 테스트 코드를 작성함으로써, 새로운 기능이 제대로 작동함과 동시에 기존의 기능들이 잘 작동하는지 테스트를 통해 확인할 수 있는 것이다.

##### Refactor Code

코드량이 방대해지면서 리팩토링을 하게 된다. 이 때 테스트 주도 개발을 해왔다면, 테스트 코드가 그 중심을 잡아줄 수 있다. 큰 함수를 여러 함수로 나누는 과정에서 해당 기능이 오작동을 일으킬 수 있지만 간단히 테스트를 돌려봄으로써 이에 대한 안심을 하고 계속해서 리팩토링을 진행할 수 있다. 결과적으로 리팩토링 속도도 빨라지고 코드의 퀄리티도 그만큼 향상하게 되는 것이다. 코드 퀄리티 부분을 조금 상세히 들어가보면, 보다 객체지향적이고 확장 가능이 용이한 코드, 재설계의 시간을 단축시킬 수 있는 코드, 디버깅 시간이 단축되는 코드가 TDD와 함께 탄생하는 것이다. 



### ?

Q. 코드 생산성에 문제가 있지는 않나?

분명 코드량이 늘어난다. 코드 퀄리티보다 빠른 생산성이 요구되는 시점에서 TDD는 큰 걸림돌이 될 수 있다.



Q. 테스트 코드를 작성하기가 쉬운가?

진입장벽이 존재한다. 어떤 부분을, 어떻게 테스트 할지, 어떤 테스트 프레임워크를 사용할지 등에 대한 학습이 필요하고 익숙해지는데에도 시간이 걸린다. 팀원 전체가 익숙해져야 하는 것 또한 문제.



Q. 모든 상황에 대해서 테스트 코드를 작성할 수 있는가? 작성해야 하는가?

세상에는 다양한 사용자가 존재하며, 생각지도 못한 예외 케이스가 존재할 수 있다. 테스트 코드를 작성하는 데 주객이 전도하는 상황이 발생할 수 있다. 테스트 코드를 작성하기 위해 배보다 배꼽이 더 커지는 경우도 허다하다. 코드를 관리하는 것 또한 쉽지 않다.

모든 코드에 대해서 테스트 코드를 작성할 수 없으며 작성할 필요도 없다. 테스트 코드를 작성한다고 해서 버그가 발생하지 않는 것도 아니다.

애초에 **TDD는 100% coverage와 100% 무결성을 주장하지 않았다.**

---



### 단위 테스트 Vs. 통합 테스트

#### 단위 테스트

하나의 모듈을 기준으로 독립적으로 진행되는 **가장 작은 단위**의 테스트.

하나의 기능 또는 메소드로 이해할 수 있다. 어떤 기능이 실행되면 어떤 결과가 나온다 정도로 테스트를 진행.

#### 통합 테스트

모듈을 통합하는 과정에서 모듈 간의 호환성을 확인하기 위해 수행되는 테스트.

독립적인 기능에 대한 테스트가 아닌, 웹 페이지로부터 API를 호출하여 올바르게 동작하는 지를 확인하는 것이다.



### 단위 테스트를 작성해야 하는 이유

- 코드를 수정하거나 기능을 추가할 때 수시로 빠르게 검증할 수 있다.
- 리팩토링 시에 안정성을 확보할 수 있다.
- 개발 및 테스팅에 대한 시간과 비용을 절감할 수 있다.



#### 좋은 테스트의 특징 (FIRST)

**First**: 테스트는 빠르게 동작하여 자주 돌릴 수 있어야 한다.

**Independent**: 각각의 테스트는 **독립적**이며 서로 의존해서는 안된다.

**Repeatable**: 어느 환경에서도 반복 가능해야 한다.

**Self-Validating**: 테스트는 성공 또는 실패로 **bool 값으로 결과를 내어** 자체적으로 검증되어야 한다.

**Timely**: 테스트는 적시에 즉, 테스트하려는 실제 코드를 구현하기 직전에 구현해야 한다.



### TDD의 방법 및 순서

1. 다음 목표를 생각한다. (과도한 시간을 투자하지 않는다.)

2. 그 목표를 달성(실패)시키는 테스트 코드를 작성한다.

3. 그 테스트를 실행하여 실패시킨다. (RED)

4. 목적을 달성시키는 코드를 적는다. (깨끗함은 포기한다.)

5. 2에서 적은 테스트를 성공시킨다. (GREEN)

6. 테스트를 통과하는 상태에서 리팩토링한다.

7. 다시 1번으로 가서, 1~6번을 반복한다.

   ![image-20220613203635849](C:\Users\hahha\AppData\Roaming\Typora\typora-user-images\image-20220613203635849.png)

   

### 왜 테스트 코드를 먼저 작성해야 하죠?

- 깔끔한 코드를 작성할 수 있다.
- 장기적으로 개발 비용을 절감할 수 있다.
- 개발이 끝나면 테스트 코드를 작성하는 것은 매우 귀찮다. 실패 케이스면 더욱 그렇다.

TDD의 궁극적인 목표는 **깔끔한 코드**를 작성하는 것이다. 리팩토링 과정에서 중복된 코드들은 제거되고, 복잡한 코드들은 깔끔하게 정리된다. 

테스트 코드는 성공 케이스 뿐만 아니라 실패 케이스까지 작성해야 하기 때문에 작성해야 할 테스트의 개수는 해당 함수에서 발생 가능한 모든 경우들인 N이다. 그리고 그 중에서도 실패 테스트부터 작성해야 한다. 순차적으로 실패하는 테스트를 먼저 작성하고, 오직 테스트가 실패할 경우에만 새로운 코드를 작성해야 한다. 그리고 중복된 코드가 있으면 제거한다.



#### TDD 접근 방법

- 가짜로 구현하기: 최대한 빨리 테스트 통과를 위해 가짜 정답을 구현
- 삼각측량법: 값이 다른 여러 테스트를 작성하고 이를 일반화하여 정답 구현
- 명백하게 구현하기: 정답을 바로 구현



참고

https://mangkyu.tistory.com/182
