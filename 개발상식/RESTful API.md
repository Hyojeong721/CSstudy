# RESTful API



### REST란?

------

Representational State Transfer의 약자로 로이 필딩에 의해 최초로 소개

HTTP를 효과적으로 사용할 수 있게 하는 아키텍처



간단히 말해서 url과 http메소드를 이용해 객체화된 서비스에 접근하는 것  -  효정

REST 는 말하자면 Resource Oriented Architecture 로, API 설계의 중심에 자원(Resource)이 있고, HTTP Method 를 통해 자원을 처리하도록 설계하는 것.  - 지후

------





### REST의 구성

------

자원(Resource) - URI

행위(Verb) - HTTP METHOD

표현(Representations) - HTTP Message Pay Load

------





###  REST의 특징 (대표적 6가지)

------

1. Uniform Interface(인터페이스 일관성)
   - URI로 지정한 리소스에 대한 조작을 통일되고 한정적인 인터페이스로 수행한다.
   - HTTP 표준 프로토콜에 따르는 모든 플랫폼에서 사용이 가능하다.
2. Stateless(무상태성)
   - HTTP 프로토롤은 Stateless Protocol 이므로 REST 역시 무상태성을 갖는다.
   - Client의 context를 Server에 저장하지 않는다. 즉, 세션이나 쿠키 정보를 저장, 관리하지 않는다.
   - Server는 각각의 요청을 완전히 별개의 것으로 인식하고 처리한다.
     - 각 API 서버는 Client의 요청만을 단순 처리
     - 이전 요청이 다음 요청의 처리에 연관되지 않는다.
     - Server 처리방식에 일관성을 부여하고 부담이 줄어들며 서비스의 자유도가 높아진다.
3. Cacheable (캐시 처리 가능)
   - HTTP 프로토콜을 그대로 사용하여 웹에서 사용하는 기존의 인프라를 그대로 활용 할 수 있다.
     - 따라서, HTTP의 특징인 캐싱기능을 그대로 사용할 수 있다.
     - HTTP 프로토콜 표준에서 사용하는 Last-Modified태그나 E-Tag를 이용하면 캐싱 구현이 가능하다.
4. Self-descriptiveness (자체 표현 구조)
   - REST API 메시지만 보고도 이를 쉽게 이해할 수 있는 자체 표현 구조로 되어 있다.
     - ex) POST /photos : 새 사진 생성
5. Client-Server 구조
   - REST Server : API 제공, 비지니스 로직 처리 및 저장
   - Client : 사용자 인증이나 컨텍스트(세션, 로그인 정보) 등을 직접 관리
   - 각각의 역할을 확실히 구분하여 서로간의 의존성이 줄어든다.
6. Layered System (계층형 구조)
   - REST 서버는 다중 계층으로 구성될 수 있다.
   - 보안, 로드밸런싱, 암호화, 사용자 인증 등을 추가해 구조상의 유연성을 둘수 있다.
   - PROXY, 게이트웨이 같은 네트워크 기반의 중간매체를 사용할 수 있다.

------





### REST API 디자인 가이드

------

**첫 번째, URI는 정보의 자원을 표현해야한다.**

**두 번째, 자원에 대한 행위는 HTTP Method(GET, POST, PUT, DELETE)로 표현한다.**



#### HTTP METHOD의 알맞은 역할

| METHOD | 역할                                       |
| ------ | ---------------------------------------- |
| POST   | POST를 통해 해당 URI를 요청하면 리소스를 생성합니다.        |
| GET    | GET를 통해 해당 리소스를 조회합니다. 리소스를 조회하고 해당 도큐먼트에 대한 자세한 정보를 가져온다. |
| PUT    | PUT를 통해 해당 리소스를 수정합니다.                   |
| DELETE | DELETE를 통해 리소스를 삭제합니다.                   |

※ 이외에도 PATCH 라는 HTTP Method 가 있다. 최근 update 이벤트에서 PUT보다 적합하다는 평가를 받는중.

- `PUT` : 자원 **전체** 교체 (자원의 모든 필드 필요)

- `PATCH` : 자원의 **부분** 교체 (자원의 일부 필드 필요)

  ​



#### URI 설계 예

| HTTP Verb | Path             | action  | used for                                 |
| --------- | ---------------- | ------- | ---------------------------------------- |
| GET       | /photos          | index   | display a list of all photos             |
| GET       | /photos/new      | new     | return an HTML form for creating a new photo |
| POST      | /photos          | create  | create a new photo                       |
| GET       | /photos/:id      | show    | display a specific photo                 |
| GET       | /photos/:id/edit | edit    | return an HTML form for editing a photo  |
| PUT       | /photos/:id      | update  | update a specific photo                  |
| DELETE    | /photos/:id      | destroy | delete a specific photo                  |

입력 Form은?

Form 자체도 정보로 취급하여 GET 요청으로 가져온다.



#### URI 설계 시 주의할 점

1. 슬래시 구분자(/)는 계층 관계를 나타내는 데 사용

   ```
   http://restapi.example.com/houses/apartments
   http://restapi.example.com/animals/mammals/whales
   ```


2. URI 마지막 문자로 슬래시(/)를 포함하지 않는다.
3. 하이픈(-)은 URI 가독성을 높이는데 사용
4. 밑줄(_)은 URI에 사용하지 않는다.
5. URI 경로에는 소문자가 적합하다.
6. 파일 확장자는 URI에 포함시키지 않는다.



#### 리소스 간의 관계를 표현하는 방법

REST 리소스 간에는 연관 관계가 있을 수 있고, 이런 경우 다음과 같은 표현방법으로 사용합니다.

```
    /리소스명/리소스 ID/관계가 있는 다른 리소스명
    ex)    GET : /users/{userid}/devices (일반적으로 소유 ‘has’의 관계를 표현할 때)
```

만약에 관계명이 복잡하다면 이를 서브 리소스에 명시적으로 표현하는 방법이 있습니다. 예를 들어 사용자가 ‘좋아하는’ 디바이스 목록을 표현해야 할 경우 다음과 같은 형태로 사용될 수 있습니다.

```
    GET : /users/{userid}/likes/devices (관계명이 애매하거나 구체적 표현이 필요할 때)
```



#### 자원을 표현하는 Collection과 Document

- Collection은 문서들의 집합, 객체들의 집합
- Document는 문서, 하나의 객체

| Resource   | GET                                     | PUT                        | POST                                     | DELETE                |
| ---------- | --------------------------------------- | -------------------------- | ---------------------------------------- | --------------------- |
| Collection | 컬렉션에 속한 자원들의 URI나 그 상세사항의 **목록**을 보여준다. | 전체 컬렉션은 다른 컬렉션으로 **교체**한다. | 해당 컬렉션에 속하는 새로운 자원을 **생성**한다. 자원의 URI는 시스템에 의해 할당된다. | 전체 컬렉션을 **삭제**한다.     |
| Document   | 요청한 컬렉션 내 자원을 **반환**한다.                 | 해당 자원을 **수정**한다.           | 해당 자원에 귀속되는 새로운 자원을 **생성**한다.            | 해당 컬렉션내 자원을 **삭제**한다. |

------





### HTTP 응답 상태 코드

------

잘 설계된 REST API는 URI만 잘 설계된 것이 아닌 리소스에 대한 응답을 잘 내어주는 것 까지 포함되어야 합니다. 정확한 응답의 상태코드만으로도 많은 정보를 전달할 수가 있기 때문에 응답의 상태코드를 명확히 돌려주어야 합니다.

#### 대표적인 상태코드

| 상태코드 |                                          |
| ---- | ---------------------------------------- |
| 200  | 클라이언트의 요청을 정상적으로 수행함                     |
| 201  | 클라이언트가 어떠한 리소스 생성을 요청, 해당 리소스가 성공적으로 생성됨(POST를 통한 리소스 생성 작업 시) |

| 상태코드 |                                          |
| ---- | ---------------------------------------- |
| 400  | 클라이언트의 요청이 부적절 할 경우 사용하는 응답 코드           |
| 401  | 클라이언트가 인증되지 않은 상태에서 보호된 리소스를 요청했을 때 사용하는 응답 코드 |
|      | (로그인 하지 않은 유저가 로그인 했을 때, 요청 가능한 리소스를 요청했을 때) |
| 403  | 유저 인증상태와 관계 없이 응답하고 싶지 않은 리소스를 클라이언트가 요청했을 때 사용하는 응답 코드 |
|      | (403 보다는 400이나 404를 사용할 것을 권고. 403 자체가 리소스가 존재한다는 뜻이기 때문에) |
| 405  | 클라이언트가 요청한 리소스에서는 사용 불가능한 Method를 이용했을 경우 사용하는 응답 코드 |

| 상태코드 |                                          |
| ---- | ---------------------------------------- |
| 301  | 클라이언트가 요청한 리소스에 대한 URI가 변경 되었을 때 사용하는 응답 코드 |
|      | (응답 시 Location header에 변경된 URI를 적어 줘야 합니다.) |
| 500  | 서버에 문제가 있을 경우 사용하는 응답 코드                 |

------





### REST의 장단점

------



#### 장점

- HTTP 프로토콜의 인프라를 그대로 사용하므로 REST API 사용을 위한 별도의 인프라를 구출할 필요가 없다.
- HTTP 프로토콜의 표준을 최대한 활용하여 여러 추가적인 장점을 함께 가져갈 수 있게 해준다.
- HTTP 표준 프로토콜에 따르는 모든 플랫폼에서 사용이 가능하다.
- Hypermedia API의 기본을 충실히 지키면서 범용성을 보장한다.
- REST API 메시지가 의도하는 바를 명확하게 나타내므로 의도하는 바를 쉽게 파악할 수 있다.
- 여러 가지 서비스 디자인에서 생길 수 있는 문제를 최소화한다.
- 서버와 클라이언트의 역할을 명확하게 분리한다.



#### 단점

- 표준이 자체가 존재하지 않아 정의가 필요하다.
- 사용할 수 있는 메소드가 4가지밖에 없다.
- HTTP Method 형태가 제한적이다.
- 브라우저를 통해 테스트할 일이 많은 서비스라면 쉽게 고칠 수 있는 URL보다 Header 정보의 값을 처리해야 하므로 전문성이 요구된다.
- 구형 브라우저에서 호환이 되지 않아 지원해주지 못하는 동작이 많다.(익스폴로어)

------





### 그래서 RESTful API???

------

위에 서술한 REST의 설계 규칙을 잘 지켜서 설계된 API를 RESTful 한 API라고 한다.

------



